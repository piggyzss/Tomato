# 测试重置功能

## 测试步骤

### 1. 准备测试数据

1. 创建几个任务
2. 启动番茄钟计时
3. 暂停计时器（例如在 6 秒时暂停）
4. 完成一些任务

### 2. 测试手动重置

1. 点击主界面底部的 **橙色重置按钮** 🔄
2. 确认操作
3. 检查结果：
   - ✅ 任务列表已清空
   - ✅ 计时器恢复到初始状态（25分钟或设置的工作时长）
   - ✅ 计时器状态为 idle（空闲）
   - ✅ 历史记录中保存了刚才的数据

### 3. 验证历史数据

1. 点击 **分析** 按钮
2. 选择 **History**
3. 检查：
   - ✅ 看到今天的历史记录
   - ✅ 显示正确的番茄钟数、专注时长、完成任务数
   - ✅ 任务列表完整

### 4. 测试自动重置（可选）

**方法 1：修改系统时间**
1. 修改系统时间到第二天
2. 重新打开插件
3. 应该自动触发归档和重置

**方法 2：等待零点**
1. 在零点前创建一些任务
2. 等待零点过后
3. 重新打开插件
4. 检查是否自动归档和重置

## 预期结果

### 重置后的状态

**任务列表**
- 空列表
- 没有当前任务

**计时器**
- 显示初始时长（例如 25:00）
- 状态为 idle
- 可以正常启动新的番茄钟

**历史记录**
- 包含重置前的所有数据
- 按日期排序
- 可以查看详情

### 不应该发生的情况

❌ 数据丢失（应该在历史记录中）
❌ 计时器保持暂停状态
❌ 计时器显示之前的剩余时间
❌ 重复归档同一天的数据

## 常见问题

### Q: 重置后计时器还是显示之前的时间？
A: 检查是否正确清除了 timerState，可以查看 Chrome DevTools → Application → Storage → Local Storage

### Q: 历史记录没有显示？
A: 检查 history 字段是否正确保存，可以在 Chrome DevTools 中查看

### Q: 重置按钮点击没反应？
A: 检查浏览器控制台是否有错误信息

## 调试技巧

### 查看存储数据

在浏览器控制台执行：
```javascript
chrome.storage.local.get(null, (data) => console.log(data))
```

### 清空所有数据

```javascript
chrome.storage.local.clear(() => console.log('cleared'))
```

### 查看定时任务

```javascript
chrome.alarms.getAll((alarms) => console.log(alarms))
```

### 手动触发定时任务

```javascript
chrome.alarms.create('dailyReset', { when: Date.now() + 1000 })
```

## 性能检查

- 归档操作应该在 1 秒内完成
- 不应该阻塞 UI
- 重置后界面应该立即更新
- 历史记录加载应该流畅

## 边界情况测试

1. **空数据重置**：没有任务时重置
2. **大量数据**：100+ 任务时重置
3. **计时器运行中**：计时器运行时重置
4. **多次重置**：连续多次点击重置按钮
5. **跨天边界**：23:59:59 到 00:00:01 的情况
