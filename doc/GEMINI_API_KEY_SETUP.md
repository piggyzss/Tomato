# Gemini API Key 获取与设置指南

## 📖 目录

- [获取 API Key](#获取-api-key)
- [在插件中设置](#在插件中设置)
- [验证配置](#验证配置)
- [安全说明](#安全说明)
- [常见问题](#常见问题)

---

## 🔑 获取 API Key

### 步骤 1：访问 Google AI Studio

打开浏览器，访问：
```
https://aistudio.google.com/app/apikey
```

或访问主页：
```
https://aistudio.google.com/
```

### 步骤 2：登录 Google 账号

- 使用你的 Google 账号登录
- 如果没有账号，需要先注册

### 步骤 3：创建 API Key

**首次访问**：
1. 点击 **"Create API Key"** 或 **"Get API Key"** 按钮

**选择项目**：
- 有现有项目 → 选择现有项目
- 没有项目 → 选择 **"Create API key in new project"**（推荐）

**生成 API Key**：
- 系统会自动生成 API Key
- 格式：`AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX`

### 步骤 4：复制 API Key

1. 点击 API Key 旁边的 📋 复制图标
2. 或手动选中并复制
3. **妥善保存，不要分享给他人**

### 步骤 5：了解免费额度

**Gemini 1.5 Flash 免费额度**：
- ✅ 每分钟 15 次请求
- ✅ 每天 1,500 次请求
- ✅ 每月 100 万 tokens
- ✅ 完全免费，无需信用卡

**足够日常使用**：
- 番茄猫消息生成
- 每日总结
- 对话交互

---

## 🔧 在插件中设置

### 方式 1：通过 UI 设置（推荐）⭐

#### 1. 打开插件
- 点击 Chrome 工具栏中的番茄猫图标
- Side Panel 在右侧打开

#### 2. 进入 AI 面板
- 点击底部的 **🤖 AI 按钮**
- 进入 AI 功能菜单

#### 3. 打开 AI 设置
- 点击 **"AI 设置"** 选项
- 进入设置页面

#### 4. 输入 API Key
- 在 **"Gemini API Key"** 输入框中粘贴
- 默认隐藏显示（`••••••••`）
- 点击 👁️ 图标可显示/隐藏

#### 5. 保存设置
- 点击 **"保存"** 按钮
- 看到 **"已保存 ✓"** 提示
- API Key 已保存到本地

#### 6. 验证配置
返回 AI 菜单，查看状态：
```
云端 AI (Gemini API)
✅ 已配置
```

#### 7. 测试功能
1. 点击 **"统一 AI Demo"**
2. 发送测试消息："你好"
3. 收到回复 = 配置成功！

---

### 方式 2：通过开发者工具（开发者）

#### 打开 DevTools
- 按 `F12` 打开开发者工具
- 切换到 **Console** 标签

#### 设置 API Key
```javascript
chrome.storage.local.set({ 
  geminiApiKey: 'YOUR_API_KEY_HERE' 
}, () => {
  console.log('✅ API Key 已保存');
});
```

#### 验证保存
```javascript
chrome.storage.local.get('geminiApiKey', (result) => {
  console.log('当前 API Key:', result.geminiApiKey);
});
```

#### 刷新插件
- 关闭并重新打开插件
- 或刷新页面

---

## 🎨 设置界面说明

```
┌─────────────────────────────────┐
│  ← AI 设置                 🔧   │
├─────────────────────────────────┤
│  💡 关于 API Key                │
│  • 当内置 AI 不可用时使用云端   │
│  • API Key 仅存储在本地         │
│  • Gemini 1.5 Flash 有免费额度  │
├─────────────────────────────────┤
│  Gemini API Key                 │
│  ┌───────────────────────────┐  │
│  │ ••••••••••••••••••••  👁️ │  │
│  └───────────────────────────┘  │
├─────────────────────────────────┤
│  ┌─────────┐  ┌─────────┐      │
│  │  保存   │  │  清除   │      │
│  └─────────┘  └─────────┘      │
├─────────────────────────────────┤
│  如何获取 API Key？             │
│  1. 访问 Google AI Studio      │
│  2. 登录 Google 账号            │
│  3. 点击 "Get API Key"          │
│  4. 创建或选择项目              │
│  5. 复制生成的 API Key          │
│                                 │
│  [前往 Google AI Studio →]     │
├─────────────────────────────────┤
│  AI 提供商状态                  │
│  内置 AI    优先使用            │
│  云端 AI    ✅ 已配置           │
└─────────────────────────────────┘
```

---

## ✅ 验证配置

### 验证清单

- [ ] 已访问 Google AI Studio
- [ ] 已创建 API Key
- [ ] 已复制 API Key
- [ ] 已在插件中粘贴
- [ ] 已点击"保存"
- [ ] 看到"已保存 ✓"提示
- [ ] 状态显示"已配置"
- [ ] 测试消息成功

### 快速测试

**测试 1：统一 AI Demo**
1. 打开插件 → 🤖 按钮
2. 选择"统一 AI Demo"
3. 输入："你好"
4. 点击"发送"
5. 应收到回复

**测试 2：查看提供商**
在"统一 AI Demo"中查看：
- 💻 内置 AI → 使用本地
- ☁️ 云端 AI → 使用 API Key

**测试 3：强制云端**
1. 暂时禁用 Chrome flags
2. 重启浏览器
3. 应自动使用云端 AI

---

## 🔐 安全说明

### 存储位置
- ✅ 存储在 `chrome.storage.local`（本地）
- ✅ 不上传到服务器
- ✅ 只有插件可访问
- ✅ 卸载后自动删除

### 安全建议
1. **不要分享** API Key
2. **不要提交** 到代码仓库
3. **定期检查** 使用情况
4. **如果泄露** 立即删除重建

### 查看使用情况
访问：https://aistudio.google.com/app/apikey

可以看到：
- API Key 列表
- 使用统计
- 删除/重建选项

---

## ❓ 常见问题

### Q: API Key 格式是什么？
**A:** 
```
AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
```
- 以 `AIzaSy` 开头
- 约 39 个字符
- 包含大小写字母和数字

### Q: 保存后没反应？
**A:** 
1. 检查格式是否正确
2. 刷新插件页面
3. 查看 Console 错误

### Q: 如何验证有效性？
**A:** 
1. 保存后发送测试消息
2. 收到回复 = 有效
3. 报错 = 检查 API Key

### Q: 可以用多个 API Key 吗？
**A:** 
目前只支持一个，但可随时更换：
1. 进入 AI 设置
2. 输入新 API Key
3. 点击保存

### Q: 如何删除 API Key？
**A:** 
1. 进入 AI 设置
2. 点击"清除"按钮
3. 从本地删除

### Q: API Key 会过期吗？
**A:** 
- 本身不过期
- Google 可能更新政策
- 建议定期检查

### Q: 免费额度用完了？
**A:** 
1. 等待第二天重置
2. 使用本地 Chrome AI
3. 升级付费计划（如需）

### Q: 如何切换提供商？
**A:** 
系统自动选择：
- 优先：内置 AI（本地）
- 备用：云端 AI（API Key）

### Q: 两个都配置了会用哪个？
**A:** 
优先使用内置 AI：
- 更快
- 免费
- 隐私
- 离线可用

### Q: 如何强制使用云端？
**A:** 
暂时禁用内置 AI：
1. 禁用 Chrome flags
2. 重启浏览器
3. 自动使用云端

---

## 📊 使用场景

### 场景 1：本地 AI 不可用
- Chrome 版本 < 127
- Flags 未启用
- 模型未下载
→ 使用云端 API Key

### 场景 2：设备性能不足
- 内存 < 8GB
- 模型运行慢
→ 使用云端 API Key

### 场景 3：需要更强能力
- 复杂任务
- 长文本生成
- 多轮对话
→ 使用云端 API Key

### 场景 4：双重保障
- 配置两种方式
- 自动智能切换
- 无缝体验

---

## 🔗 相关链接

- **Google AI Studio**: https://aistudio.google.com/
- **API Key 管理**: https://aistudio.google.com/app/apikey
- **Gemini API 文档**: https://ai.google.dev/docs
- **定价信息**: https://ai.google.dev/pricing
- **使用限制**: https://ai.google.dev/pricing#1_5flash

---

## 💡 最佳实践

### 1. 配置建议
- ✅ 同时配置本地和云端
- ✅ 本地优先，云端备用
- ✅ 定期检查使用情况

### 2. 安全建议
- ✅ 不分享 API Key
- ✅ 不提交到代码
- ✅ 定期更换 Key

### 3. 使用建议
- ✅ 优先使用"统一 AI Demo"
- ✅ 查看当前提供商
- ✅ 监控免费额度

---

**版本**: v1.0.0  
**更新日期**: 2025-10-30  
**作者**: Kiro AI Assistant
